<html>
  <head>
    <link rel="stylesheet" href="../../core/render_stage.css" />
    <script src="https://unpkg.com/blob-util/dist/blob-util.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.1.1/gsap.min.js"></script>
    <script src="../lib/gif.js"></script>
    <script src="//d3plus.org/js/d3.js"></script>
    <script src="//d3plus.org/js/d3plus.js"></script>
  </head>

  <body>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 216 216"
    >
      <defs>
        <style>
          .cls-1,
          .cls-3 {
            fill: none;
          }
          .cls-2 {
            fill: #fff;
          }
          .cls-4 {
            fill: #c4edff;
          }
          .cls-5 {
            clip-path: url(#clip-path);
          }
          .cls-7 {
            fill: #333;
          }
          .cls-8 {
            opacity: 0.4;
          }
          #text {
            stroke: #fff;
            fill: #a28269;
            font-family: JandaManateeSolid, Janda Manatee Solid;
          }

          .cls-9{fill: #0a0a0a; font-size:6px;font-family:JandaManateeSolid, Janda Manatee Solid;}
        </style>
        <clipPath id="clip-path">
          <path id="fill-mask" class="cls-1" d="M64.91,150.65l88.13-.33C152,174,132.85,193,109.81,193.44,86.28,193.89,66.12,174.87,64.91,150.65Z" />

        </clipPath>
      </defs>
      <g id="Layer_1" data-name="Layer 1">
        <path class="cls-2" d="M172.12,142h-3.47a60.16,60.16,0,0,0-15-32.17c-17.73-20-58.64-28.29-87-2.23-9.81,9-15.53,21.3-17.2,34.4H46a8.72,8.72,0,1,0,0,17.44H99.16a13.17,13.17,0,0,0,19.81,0h53.15a8.72,8.72,0,1,0,0-17.44Z" />
        <rect class="cls-3" x="63.68" y="31.56" width="66.49" height="66.49" />
    </g>
    <g id="Layer_1" data-name="Layer 1">
      <path class="cls-2" d="M172.12,142h-3.47a60.16,60.16,0,0,0-15-32.17c-17.73-20-58.64-28.29-87-2.23-9.81,9-15.53,21.3-17.2,34.4H46a8.72,8.72,0,1,0,0,17.44H99.16a13.17,13.17,0,0,0,19.81,0h53.15a8.72,8.72,0,1,0,0-17.44Z" />
      <rect class="cls-3" x="55.68" y="31.56" width="106.49" height="66.49" />
      <text id="text" fill="#4c3d63" font-size="14px"></text>
  </g>
  <g id="Layer_1_copy" data-name="Layer 1 copy">
      <path class="cls-4" d="M57.6,150.66v-.91c0-28.38,22.7-50.61,51.67-50.61a55.85,55.85,0,0,1,5.76.3,51.88,51.88,0,0,1,32.63,16.21,50,50,0,0,1,13.28,34.1v.91Z" />
      <path fill="#0a0a0a" d="M109.27,100.06a55.71,55.71,0,0,1,5.66.29C140.3,103,160,123.63,160,149.75H58.51c0-28,22.73-49.69,50.76-49.69m0-1.84A53,53,0,0,0,72.1,113.08a50.67,50.67,0,0,0-15.42,36.67v1.83H161.85v-1.83A50.93,50.93,0,0,0,148.33,115a52.77,52.77,0,0,0-33.21-16.49,57.62,57.62,0,0,0-5.85-.31Z" />
      <path fill="#0a0a0a" d="M172.12,151.89H46a1.22,1.22,0,1,1,0-2.44H172.12a1.22,1.22,0,1,1,0,2.44Z" />
      <g class="cls-5">
          <path id="main" d="M153.05,149.45H64.92c1.09-23.72,20.35-42.61,43.39-43C131.85,106.12,151.93,125.22,153.05,149.45Z" />
      </g>
      <path class="cls-2" d="M73.19,144.72a1,1,0,0,1-.24,0,1.22,1.22,0,0,1-1-1.43,37.32,37.32,0,0,1,4.42-11.65,38.32,38.32,0,0,1,3.41-4.9,1.22,1.22,0,1,1,1.89,1.55,35.28,35.28,0,0,0-7.33,15.47A1.22,1.22,0,0,1,73.19,144.72Z" />
      <g id="meter">
          <path fill="#0a0a0a" d="M62.92,151c1-.08,24.86-2.11,36.1-3,3-.22,5-.37,5.6-.38,2.71,0,4.91,1.18,4.94,2.72s-2.15,2.82-4.86,2.86c-.54,0-2.53-.08-5.37-.22C88.17,152.51,63.86,151.1,62.92,151Z" />
          <path class="cls-7" d="M99,148.07c3-.22,5-.37,5.6-.38,2.71,0,4.91,1.18,4.94,2.72s-2.15,2.82-4.86,2.86c-.54,0-2.53-.08-5.37-.22a5.7,5.7,0,0,1-.31-5Z" />
      </g>
      <circle fill="#0a0a0a" cx="109.06" cy="150.67" r="5.72" />

      <path fill="#0a0a0a" d="M109.06,110.94a.88.88,0,0,1-.88-.88V99.28a.88.88,0,1,1,1.76,0v10.78A.88.88,0,0,1,109.06,110.94Z" />
      <path fill="#0a0a0a" d="M95.19,108.86a.89.89,0,0,1-.84-.61l-2-6.19a.88.88,0,1,1,1.68-.54l2,6.19a.88.88,0,0,1-.57,1.11A.84.84,0,0,1,95.19,108.86Z" />
      <path fill="#0a0a0a" d="M82.68,115.24a.87.87,0,0,1-.71-.37l-3.83-5.26a.88.88,0,0,1,1.43-1l3.82,5.27a.88.88,0,0,1-.19,1.23A.92.92,0,0,1,82.68,115.24Z" />
      <path fill="#0a0a0a" d="M72.75,125.16a.91.91,0,0,1-.52-.16L67,121.17a.88.88,0,1,1,1-1.42l5.27,3.82a.88.88,0,0,1,.19,1.23A.86.86,0,0,1,72.75,125.16Z" />
      <path fill="#0a0a0a" d="M66.38,137.68a.92.92,0,0,1-.28-.05l-6.19-2a.88.88,0,1,1,.55-1.67l6.19,2a.88.88,0,0,1-.27,1.72Z" />
      <path fill="#0a0a0a" d="M151.74,137.68a.88.88,0,0,1-.27-1.72l6.19-2a.88.88,0,0,1,.55,1.67l-6.19,2A.92.92,0,0,1,151.74,137.68Z" />
      <path fill="#0a0a0a" d="M145.37,125.16a.86.86,0,0,1-.71-.36.88.88,0,0,1,.19-1.23l5.27-3.82a.88.88,0,1,1,1,1.42L145.89,125A.91.91,0,0,1,145.37,125.16Z" />
      <path fill="#0a0a0a" d="M135.44,115.24a.92.92,0,0,1-.52-.17.88.88,0,0,1-.19-1.23l3.82-5.27a.88.88,0,0,1,1.43,1l-3.83,5.26A.87.87,0,0,1,135.44,115.24Z" />
      <path fill="#0a0a0a" d="M122.93,108.86a.84.84,0,0,1-.27,0,.88.88,0,0,1-.57-1.11l2-6.19a.88.88,0,0,1,1.68.54l-2,6.19A.89.89,0,0,1,122.93,108.86Z" />
      <path class="cls-2" d="M120.42,137.89a1,1,0,0,1-.55-1.73l20.37-14.49a1,1,0,1,1,1.11,1.55L121,137.72A.92.92,0,0,1,120.42,137.89Z" />
      <path class="cls-2" d="M127.94,137.89a.92.92,0,0,1-.77-.39,1,1,0,0,1,.2-1.33l9.87-7.25a1,1,0,0,1,1.13,1.54l-9.87,7.25A1,1,0,0,1,127.94,137.89Z" />
      <text id="midpoint" class="cls-9" transform="translate(109.07 116.03)" text-anchor="middle"></text>
      <text id="goal" class="cls-9" transform="translate(149.29 143.17)" text-anchor="middle"></text>
      <text class="cls-9" transform="translate(65.67 143.17)" >0</text>
  </g>
    </svg>

    <section></section>

    <script>
        var color = {
          purple: { main: "#b760c2", text: "#ff6363" },
          gold: { main: "#fcc335", text: "#ef1796" },
          red: { main: "#ff6363", text: "#81bf40" },
          green: { main: "#7dde18", text: "#fcc335" },
          pink: { main: "#f28cc9", text: "#964f9f" },
        };

        var colorSelection = new URL(window.location.href).searchParams.get(
          "color"
        );
        document
          .getElementById("main")
          .setAttribute("style", "fill:" + color[colorSelection]["main"]);
        document
          .getElementById("text")
          .setAttribute("style", "fill:" + color[colorSelection]["text"]);

      var svg = document.querySelector("svg");
      tl = gsap.timeline({ paused: true });

      var maskPercentage = 18 + 162 * (new URL(
        window.location.href
      ).searchParams.get("value") / new URL(
        window.location.href
      ).searchParams.get("goal"));
      
      var option = new URL(window.location.href).searchParams.get("option");
      if(option === "fill") {
        var gsap_animation = 
          tl.to("#fill-mask", {duration:1.5, rotation:maskPercentage, transformOrigin: "top center", stagger:0.4})
          .to("#meter", {duration:1.5, rotation:maskPercentage, transformOrigin: "right center", stagger:0.4}, 0)
                            .to(svg, 0.8, {
                            scaleX: 1.05,
                            scaleY: 1.05,
                            ease: Elastic.easeOut,
                            repeatDelay: 0.5,
                            repeat: 0
                            });
      } else {
        //TODO: the fill mask doesn't seem to copy over, but mostly working seems close enough :-)
        tl.to("#fill-mask", {duration:0, rotation:maskPercentage, transformOrigin: "top center"}).play();
        tl.to("#meter", {duration:0, rotation:maskPercentage, transformOrigin: "right center"}).play();
      }
                
    </script>
    <script src="../lib/moment.js"></script>
    <script src="../core/timeparser.js"></script>
    <script src="../core/textwrap.js"></script>
    <script src="../core/options.js"></script>
    <script src="../core/render.js"></script>
  </body>
</html>
